<!DOCTYPE html>
<html>
    <head>
        <title>idea</title>
        <link rel="icon" type="image/png" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAV1BMVEUAAAAYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBggJxpgpi9lrzEpOR00UCFzyTZDbSZXlCwmMxxIdyddoC5xxTVrujMgKBohKhpsuzMtQx5PhCpUjiyJFHa5AAAACXRSTlMAMZja+gqb/sI2q192AAAAgElEQVQY02WP2xKDIAxEQ4Jg7CVqK7a1//+dDQkzrXZfAmcCuwugCkgxEgZwdSnzcDpfOKfO7j0zX0VGHX0lSQ++oUr6PvOPcgCscxKR2QgC1XG7Lw0QRN8tDcR/QHtA/ukXoNuuj6e8Vre1YEVtpXgwi769VVuLbuU8ppc71P8AYlEIqJ+LVz0AAAAASUVORK5CYII=">

        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <style>
            /* Colors taken from <https://tsoding.github.io/schedule/> */
            :root {
                --bg: #181818;
                --bg-light: #1b1b1b;

                --fg: #e4e4ef;
                --fg-dark: #515151;

                --green: #73c936;
                --blue-dark: #1e2030;
                --blue-light: #222436;
            }

            body {
                background: var(--bg);
                color: var(--fg);
            }

            .todo {
                background: var(--bg-light);
                width: 50%;
                margin-top: 25px;
                margin-left: 25%;

                border-radius: 15px;
                border: 2px solid var(--fg-dark);

                transform-origin: center;
            }

            .todo h2 {
                font-size: 22px;
                text-align: center;
                margin-bottom: 0px;
            }

            .arrow_show {
                color: var(--fg-dark);
                width: 100%;
                text-align: center;
                margin: 0px;
                font-size: 15px;

                opacity: 0;
            }

            .todo_data {
                padding: 12px;
                padding-top: 0px;
            }

            .todo_notes {
                background: var(--blue-dark);
                width: 100%;
                border-spacing: 0px; /* Make the line-nr right border continuous vertically */
                padding: 5px;
                border-radius: 15px;
                border: 3px solid var(--blue-light);
            }

            .todo_notes_line {
                width: 100%;
                text-align: left;
                padding-left: 5px;
                overflow-wrap: anywhere; /* Fix text overflowing the table */
            }

            .todo_notes_line_nr {
                color: var(--fg-dark);
                border-right: 2px dashed var(--bg-light);

                width: fit-content;
                vertical-align: top;
                text-align: right;
                padding-right: 5px;
            }

            hr {
                border: 1px solid var(--fg-dark);
            }

            h1 {
                text-align: center;
                color: var(--green);
            }

            header {
                background: var(--bg);

                position: sticky;
                top: 0px;
            }

            footer {
                text-align: center;
            }

            a {
                text-decoration: none;
                color: var(--green);
                border-bottom: 1px solid;
            }

            .text_dark {
                color: var(--fg-dark);
            }

            /* Source: https://stackoverflow.com/a/2310809 */
            .unselectable {
                -webkit-touch-callout: none;
                -webkit-user-select: none;
                -khtml-user-select: none;
                -moz-user-select: none;
                -ms-user-select: none;
                user-select: none;
            }

            @media (max-device-width: 640px), (max-width: 1100px), print {
                .todo {
                    width: 98%;
                    margin-left: 1%;
                }
            }

            @media print {
                .arrow_show {
                    opacity: 0 !important;
                }

                .todo_data {
                    display: revert !important;
                }

                .todo_header_separator {
                    display: revert !important;
                }

                header {
                    position: revert;
                }
            }
        </style>
    </head>

    <body>
        <header>
            <h1>idea</h1>
            <hr>
        </header>

        <main>
            <div id="todos_container">
                <c> List_iterator iterator = list_iterator_create(todo_list); </c>
                <c> while (list_iterator_next(&iterator)) { </c>
                    <c> Todo *e = list_iterator_element(iterator); </c>
                    <div class="todo">
                        <div class="todo_header">
                            <h2 class="unselectable"><c>CSTR(e->name)</c></h2>
                            <p class="arrow_show unselectable">&#9660;</p>
                        </div>

                        <hr class="todo_header_separator">
                        <div class="todo_data">
                            <p class="todo_info">Created on <b><c>TIME(e->creation_time)</c></b> on <b><c>CSTR(e->hostname)</c></b></p>

                            <c> if (e->notes) { </c>
                                <h3>Notes:</h3>
                                <table class="todo_notes">
                                    <c>
                                        char *notes = e->notes;
                                        unsigned int line_nr = 0;
                                        bool new_line = true;

                                        while (*notes) {
                                            if (new_line) {
                                                line_nr++;
                                                new_line = false;
                                                </c>
                                                    <tr>
                                                        <td class="todo_notes_line_nr unselectable"><c>UINT(line_nr)</c></td>
                                                        <td class="todo_notes_line">
                                                <c>
                                            }

                                            switch (*notes) {
                                                case '\n':
                                                    new_line = true;
                                                    </c>
                                                            </td>
                                                        </tr>
                                                    <c>
                                                    break;

                                                default:
                                                    CHAR(*notes);
                                                    break;
                                            }
                                            notes++;
                                        }
                                    </c>
                                </table>
                            <c> } </c>
                        </div>
                    </div>
                <c> } </c>
            </div>
        </main>

        <footer>
            <br>
            <hr>
            <p>
                <span class="text_dark">Exported on</span>

                <c>
                    time_t now = time(NULL);
                    TIME(now)
                </c>

                <span class="text_dark">from</span>

                <c>
                    char hostname[256];
                    if (gethostname(hostname, sizeof(hostname)) == -1) return ERROR("Unable to get the hostname for exporting the ToDo");
                    CSTR(hostname);
                </c>

                <c> #ifdef COMMIT </c>
                    <br> <span class="text_dark">with version: </span><c>CSTR(COMMIT)</c>
                <c> #endif // COMMIT </c>
            </p>


            <a href="https://www.github.com/Ezee1015/idea">Source code of idea</a>

        </footer>
    </body>

    <script>
        const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent); // Source: https://stackoverflow.com/a/29509267
        const todos = document.getElementsByClassName("todo")

        function getElementInsideTodoContainer(container, className) {
            const list = container.getElementsByClassName(className)
            if (list.length != 1) console.log("Error. There's more then one `" + className + "` in a `todo_container`")
            return list[0]
        }

        for (const todo of todos) {
            const data      = getElementInsideTodoContainer(todo, "todo_data")
            const header    = getElementInsideTodoContainer(todo, "todo_header")
            const arrow     = getElementInsideTodoContainer(todo, "arrow_show")
            const info      = getElementInsideTodoContainer(todo, "todo_info")
            const separator = getElementInsideTodoContainer(todo, "todo_header_separator")

            // I put display: none in the JS and not in the CSS because if the
            // browser doesn't execute the JS, the data can still be displayed
            separator.style.display = "none"
            data.style.display = "none"

            if (!isMobile) {
                // This gives some problems in mobile, because there's no cursor
                arrow.style.transition = "opacity 0.15s"
                header.onmouseenter= () => {
                    arrow.style.opacity = "1"
                }
                header.onmouseleave = () => {
                    arrow.style.opacity = "0"
                }
            }

            header.onclick = () => {
                if (data.style.display == "none") {
                    if (isMobile) arrow.style.opacity = "1"
                    arrow.innerHTML = "&#9650;"

                    separator.style.display = ""
                    data.style.display = ""
                } else {
                    if (isMobile) arrow.style.opacity = "0"
                    arrow.innerHTML = "&#9660;"

                    separator.style.display = "none"
                    data.style.display = "none"
                }

                const rect = todo.getBoundingClientRect();
                const shake = (data.style.display == "none") ? { y: 5, x: 5 } :  { y: -5, x: -5 };

                const shake_scale = {
                    x: (rect.width + shake.x) / rect.width,
                    y: (rect.height + shake.y) / rect.height
                }
                todo.animate([
                    { transform: "scale(1) " },
                    { transform: "scale(" + shake_scale.x + ", " + shake_scale.y + ")" },
                    { transform: "scale(1) " },
                ], {
                    duration: 100,
                })
            }
        }
    </script>
</html>
